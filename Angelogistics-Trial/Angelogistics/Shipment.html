<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shipments</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
  * {
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #d9d9d9;
      display: flex;
      height: 100vh;
      overflow-x: hidden;
    }
    
    h1 {
      margin: 0;
    }

    .user-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }

    
    /* Sidebar */
  
    .sidebar {
  height: 100vh;
  width: 250px;
  position: fixed;
  top: 0;
  left: 0;
  background-color: #ffffff;
  transition: width 0.3s ease;
  overflow-x: hidden;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  z-index: 1002;
}

.sidebar.collapsed {
  width: 70px;
}

.sidebar a {
  height: 50px;
  padding: 12px 20px;
  text-decoration: none;
  font-size: 17px;
  color: #000000;
  display: flex;
  align-items: center;
  gap: 12px;
  white-space: nowrap;
  overflow: hidden;
  transition: 0.3s;
}


.sidebar.collapsed a {
  justify-content: center;
  gap: 0;
}

.sidebar.collapsed a span {
  display: none;
}



/* Logo & toggle button */
.logo-section {
  padding: 10px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: relative; /* optional, for absolute positioning of logo inside */
}

.logo-img {
  width: 150px;
  max-height: 150px;
  object-fit: contain;
  transition: opacity 0.3s ease, width 0.3s ease;
}


/* Hide the logo when sidebar is collapsed */
.sidebar.collapsed .logo-img {
  /* Instead of width:0, use opacity and visibility for smooth transition */
  opacity: 0;
  visibility: hidden;
  width: 0px;
  height: 0px;
}

.sidebar .logo-section {
  height: 60px;
  padding: 40px 30px 70px 43px; /* Less top padding */
  display: flex;
  align-items: center;
  justify-content: space-between;
  
}

  .sidebar.collapsed .logo-section .text {
    display: none;
  }
  
  .toggle-btn {
    background: none;
    border: none;
    font-size: 17px;
    cursor: pointer;
    color: #444;
  }

  .sidebar .menubtn {
  position: fixed; /* ← Change from absolute to fixed */
  top: 10px;
  left: 230px;
  height: 40px;
  width: 40px;
  z-index: 9999; /* ← Way above topbar (z-index 1001) */
  color: #000000;
  background: #e9e9e9;
  text-align: center;
  line-height: 42px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 17px;
  transition: left 0.3s ease;
  box-shadow: 0 12px 16px 0 rgba(99, 99, 99, 0.24), 0 17px 50px 0 rgba(99, 99, 99, 0.24);
}


/* Move button when sidebar is collapsed */
.sidebar.collapsed .menubtn {
  left: 15px; /* matches col lapsed width */
}
  
/* Nav items */
.nav-links {
  padding: 10px 0;
  flex-grow: 1;
  transition: background-color 0.2s;
}

.nav-links a {
  display: flex;
  align-items: center;
  padding: 12px 20px;
  color: #5c5c5c;
  text-decoration: none;
  font-weight: 600;
  font-size: 17px;
  border-radius: 15px;
  cursor: pointer;
  margin: 5px 10px;
  transition: background-color 0.2s;
}

.nav-links a:hover,
.nav-links a.active {
  background: #060644;
  color: #eb972b;
  backdrop-filter: blur(4px);
  transform: scale(1.02);
}


.sidebar.collapsed .nav-links a {
  justify-content: flex;
  padding: 12px 20px;
}

.nav-links a i {
  font-size: 17px;
    min-width: 22px;
    text-align: center;
}

.sidebar.collapsed .nav-links a span {
  display: none;
} 



/* User & logout section */
.user-section {
    border-top: 1px solid #ddd;
    padding: 10px 0px;
    transition: background-color 0.2s;
  }
 
  .user-section a {
    display: flex;
    align-items: center;
    padding: 12px 20px;
    color: #5c5c5c;
    text-decoration: none;
    font-weight: 600;
    font-size: 17px;
    border-radius: 17px;
    cursor:pointer;
    margin: 5px 10px;
    transition: background-color 0.2s;
  }

  .user-section a i {
    font-size: 17px;
    min-width: 22px;
    text-align: center;
  }

  .user-section a:hover {
     background: #060644;
  color: #eb972b;
    backdrop-filter: blur(4px); /* frosted glass effect for futuristic look */
    transform: scale(1.02); /* slight enlargement for effect */
  }

  .sidebar.collapsed .user-section span {
    display: none;
  }
/* Top bar styling */

.topbar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background-color: #060644;
  font-size: 12px;
  color: white;
  padding: 10px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-left: 90px; /* default space when sidebar is collapsed */
  transition: padding-left 0.3s ease;
  z-index: 1001;
  box-shadow: 0 12px 16px 0 rgba(44, 44, 44, 0.24), 0 17px 50px 0 rgba(44, 44, 44, 0.24);
}

.topbar.shifted {
      padding-left: 280px; /* space when sidebar is expanded */
    }

     #mainContent {
  margin-left: 80px; /* collapsed sidebar */
  margin-right: 10px;
  width: calc(100% - 90px); /* 80 left + 10 right */
  padding: 20px;
  padding-top: 110px;
  transition: margin-left 0.3s ease, width 0.3s ease;
}

#mainContent.shifted {
  margin-left: 260px; /* expanded sidebar */
  width: calc(100% - 270px); /* 250 left + 10 right */
}


    .shipment-container {
      margin: 30px auto;
    }

    .action-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 15px;
      margin-bottom: 10px;
    }

    .action-buttons button {
      padding: 10px 20px;
      font-size: 14px;
      color: white;
      background-color: #060644;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .action-buttons button:hover {
      background-color: #0c234a;
    }

    .shipment-box {
      background-color: #ffffff;
      padding: 20px 30px;
      border-radius: 17px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    .shipment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .shipment-title {
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .year-filter {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .year-filter label {
      font-size: 16px;
      color: #333;
    }

    .year-filter select {
      padding: 8px 12px;
      border-radius: 20px;
      border: 1px solid #ccc;
      font-size: 14px;
      background-color: #f9f9f9;
      cursor: pointer;
    }

    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
table select, table input {
  width: 100%;
  max-width: 150px;
  box-sizing: border-box;
}
    table th, table td {
      padding: 12px;
      text-align: left;
      border: 1px solid #ddd;
      font-size: 14px;
    }

    table th {
      background-color: #f8f8f8;
      font-weight: bold;
      text-transform: uppercase;
      color: #333;
    }

    table td {
      background-color: #fff;
    }

    .days-column {
      background-color: #f9f9f9;
      font-weight: bold;
    }

    .dot-icon {
      cursor: pointer;
      font-size: 18px;
      text-align: center;
      background-color: #f1f1f1;
      padding: 8px;
      border-radius: 50%;
      transition: background-color 0.3s;
      display: inline-block;
      position: relative;
    }

    .dot-icon:hover {
      background-color: #ddd;
    }

    .popup-menu {
      display: none;
      position: absolute;
      background-color: #fff;
      border: 1px solid #ccc;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      width: 150px;
      border-radius: 12px;
      z-index: 10;
    }

    .popup-menu a {
      display: block;
      padding: 10px;
      color: #333;
      text-decoration: none;
      border-bottom: 1px solid #ddd;
    }

    .popup-menu a:hover {
      background-color: #f1f1f1;
    }

    .popup-menu a:last-child {
      border-bottom: none;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .modal-content {
      background-color: #fff;
      width: 700px;
      max-width: 90%;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .modal-header {
      background-color: #060644;
      color: #fff;
      padding: 15px;
      font-size: 20px;
      font-weight: bold;
    }

    .modal-body {
      display: flex;
      gap: 30px;
      padding: 20px;
    }

    .modal-column {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .modal-column label {
      font-weight: bold;
    }

    .modal-column input,
    .modal-column select {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 12px;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      padding: 15px;
      gap: 10px;
      border-top: 1px solid #eee;
    }

    .modal-footer button {
      padding: 8px 16px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
    }

    .modal-footer button:first-child {
      background-color: #ccc;
      color: #333;
    }

    .modal-footer button:last-child {
      background-color: #060644;
      color: white;
    }

    #containerNumbersGroup input {
      margin-bottom: 5px;
      display: block;
    }
    
    #containerNumbersGroup button {
      margin-top: 5px;
      padding: 4px 8px;
      font-size: 14px;
    }
    
    /* Consistent styling for both add (+) and delete (−) buttons */
    .containerActionBtn, .deleteContainerBtn {
      width: 30px;
      height: 30px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      font-family: inherit;
      color: #000000; /* Black text color */
      background-color: white; /* White background */
      border: 1px solid #534c4c; /* Border color */
      border-radius: 12px;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
    }
    
    /* Hover effect for both add (+) and delete (−) buttons */
    .containerActionBtn:hover, .deleteContainerBtn:hover {
      background-color: #EDEADE; /* Light beige background on hover */
      color: white; /* White text on hover */
    }

    
    /* Confirmation Modal Styles */
    .confirmation-modal {
      background-color: #fff;
      width: 400px;
      border-radius: 12px;
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
      text-align: left;
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 30;
      overflow: hidden; /* Ensures the blue header doesn't get cut */
    }

    .confirmation-modal-header {
      background-color: #060644;
      text-align: left;
      color: white;
      padding: 15px;
      font-size: 20px;
      font-weight: bold;
      width: 100%;
    }

    .confirmation-modal-body {
      padding: 20px;
      text-align: left;
    }

    .confirmation-modal-footer {
      display: flex;
      justify-content: flex-end;
      padding: 15px;
    }

    .confirmation-modal-footer button {
      padding: 10px 20px;
      background-color: #060644;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
    }

    .confirmation-modal-footer button:hover {
      background-color: #0c234a;
    }
    /* Cancellation Modal Styles */
    .cancellation-modal {
      background-color: #fff;
      width: 450px;
      border-radius: 12px;
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
      text-align: left;
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 30;
      overflow: hidden;
    }

    .cancellation-modal-header {
      background-color: #060644;
      color: white;
      padding: 15px;
      font-size: 20px;
      font-weight: bold;
      width: 100%;
    }

    .cancellation-modal-body {
      padding: 20px;
      font-size: 16px;
      line-height: 1.5;
    }

    .cancellation-modal-footer {
      display: flex;
      justify-content: flex-end;
      padding: 15px;
      gap: 10px;
    }

    .cancellation-modal-footer button {
      padding: 10px 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
    }

    #cancelYesBtn {
      background-color: #060644;
      color: white;
    }

    #cancelNoBtn {
      background-color: #ccc;
      color: #333;
    }

    /* Confirmation Modal (Delete) */
    .confirmation-modal {
      background-color: #fff;
      width: 400px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      text-align: center;
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 30;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    .confirmation-modal-header {
      background-color: #060644;
      color: white;
      padding: 16px;
      font-size: 20px;
      font-weight: bold;
    }

    .confirmation-modal-body {
      padding: 25px 20px;
      font-size: 16px;
      color: #333;
    }

    .confirmation-modal-footer {
  display: flex;
  justify-content: flex-end; /* Aligns buttons to the right */
  gap: 15px;
  padding: 20px;
  background-color: #f7f9fb;
}

    .confirmation-modal-footer button {
      padding: 10px 20px;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    #confirmActionBtn {
      background-color: #060644;
      color: white;
    }

    #confirmActionBtn:hover {
      background-color: #0c234a;
    }

    #cancelActionBtn {
      background-color: #dcdfe4;
      color: #333;
    }

    #cancelActionBtn:hover {
      background-color: #c1c6ce;
    }

    #successModal {
      background-color: #fff;
      width: 400px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      text-align: center;
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 40;
      overflow: hidden;
    }

.horizontal-row {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin-bottom: 20px;
}

.modal-item {
  flex: 1 1 18%;
  min-width: 180px;
  display: flex;
  flex-direction: column;
}

.modal-item label {
  font-weight: bold;
  margin-bottom: 5px;
}

.container-number-group {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.container-number-group .containerNumberWrapper {
  display: flex;
  align-items: center;
  gap: 5px;
}

	.cancel-confirm-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.6);
  display: flex; justify-content: center; align-items: center;
  z-index: 1000;
}

.cancel-confirm-content {
  background: white;
  border-radius: 12px;
  width: 400px;
}

.cancel-confirm-header {
  font-weight: bold;
  font-size: 1.2rem;
  margin-bottom: 1rem;
  color: white;
  background-color: #060644;
  padding: 12px;
  border-radius: 12px 12px 0 0;
}

.cancel-confirm-body {
  margin: 20px 0;
  padding: 12px;
  font-size: 16px;
  color: #333;
}

.cancel-confirm-footer {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  padding: 15px;
}

.cancel-confirm-footer button {
  padding: 8px 16px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
}

.cancel-confirm-footer button:first-child {
  background-color: #060644;
  color: white;
}

.cancel-confirm-footer button:last-child {
  background-color: #ccc;
  color: #333;
}

	/* Styles for the Shipment Details Modal */
/* Details Modal Styles */
#detailsModal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

#detailsModal .modal-content {
  background-color: #fff;
  width: 700px;
  max-width: 90%;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  display: flex;
  flex-direction: column;
}

#detailsModal .modal-header {
  background-color: #060644;
  color: #fff;
  padding: 15px;
  font-size: 20px;
  font-weight: bold;
  text-align: left; /* Left-align header text */
}

#detailsModal .modal-body {
  display: flex;
  gap: 30px;
  padding: 20px;
  flex: 1; /* Take up available vertical space */
}

#detailsModal .modal-column {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

#detailsModal .modal-column label {
  font-weight: bold;
}

#detailsModal .modal-column input,
#detailsModal .modal-column select {
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  background-color: #e9ecef;
  cursor: not-allowed;
  color: #495057;
}

#detailsModal .modal-column input:focus,
#detailsModal .modal-column select:focus {
  outline: none;
  border-color: #ccc;
}

#detailsModal .modal-footer {
  display: flex;
  justify-content: flex-end; /* Right-align button */
  padding: 15px;
  border-top: 1px solid #eee;
}

#detailsModal .modal-footer button {
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
 
    .table-responsive {
  width: 100%;
  overflow-x: auto;
}

#shipmentTable {
  width: 100%; /* Ensure the table takes full width of its container */
  max-width: 100%; /* Prevent it from exceeding the container */
  border-collapse: collapse; /* Optional: for better styling */
}

/* Optional: Media query for smaller screens */
@media (max-width: 768px) {
  #shipmentTable th, #shipmentTable td {
    font-size: 12px; /* Adjust font size for smaller screens */
  }
  
  /* Hide certain columns if necessary */
  #shipmentTable th:nth-child(n+6), /* Adjust based on your needs */
  #shipmentTable td:nth-child(n+6) {
    display: none; /* Hide columns beyond a certain index */
  }
}

</style>
</head>
<body>
  <div id="mySidebar" class="sidebar">
    <div class="logo-section">
        <img src="logoangelo.png" alt="Logo" class="logo-img" />
        <div id="toggleSidebar" class="menubtn"><i class="fas fa-bars"></i></div>
    </div>
  
    <nav class="nav-links">
      <a href="Dashboard.html"><i class="fas fa-home"></i><span>Dashboard</span></a>
      <a href="Shipment.html" class="active"><i class="fas fa-truck"></i><span>Shipments</span></a>
      <a href="records.php"><i class="fas fa-clipboard-list"></i><span>Records</span></a>
      <a href="Analytics(Yearly).html"><i class="fas fa-chart-bar"></i><span>Analytics</span></a>
    </nav>
  
    <div class="user-section">
      <a href="account.html"><i class="fas fa-user"></i> <span>My Account</span></a>
      <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a>
    </div>
  </div>
  

  <!-- Topbar -->
  <div class="topbar shifted" id="topbar">
    <h1>SHIPMENTS</h1>
    
  </div>

  <div id="mainContent" class="shifted">
  <div class="shipment-container">
    <div class="action-buttons">
      <button id="updateBtn">Update</button>
      <button id="saveBtn" style="display: none;">Save</button>
      <button id="createBtn">Create</button>
    </div>

    <div class="shipment-box">
      <div class="shipment-header">
        <div class="shipment-title">SHIPMENT LISTS</div>
        <div class="year-filter">
        </div>
      </div>

      <div class="table-responsive">
        <table id="shipmentTable">
          <colgroup>
            <col style="width: 40px;">
            <col style="width: 150px;">
            <col style="width: 150px;">
            <col style="width: 120px;">
            <col style="width: 120px;">
            <col style="width: 80px;">
            <col style="width: 80px;">
            <col style="width: 140px;">
            <col style="width: 100px;">
            <col style="width: 80px;">
            <col style="width: 60px;">
          </colgroup>
          <thead>
            <tr>
              <th>#</th>
              <th>Encoding/ Docuphase</th>
              <th>For Shipping Line/ Delivery Phase</th>
              <th>Importer</th>
              <th>Commodity</th>
              <th>No. of Containers</th>
              <th>CD</th>
              <th>Shipping Line</th>
              <th>ETA</th>
              <th class="days-column">15 DAYS</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>UPLOADED</td>
              <td>FOR DELIVERY</td>
              <td>Importer A</td>
              <td>Electronics</td>
              <td>5</td>
              <td>CD</td>
              <td>Shipping Line A</td>
              <td>2025-06-15</td>
              <td class="days-column">10</td>
              <td class="actions">
                <span class="dot-icon" onclick="togglePopup(event)">...</span>
                <div class="popup-menu">
                  <a href="#" class="details-btn">Details</a>
                  <a href="#" class="edit-btn">Edit</a>
                  <a href="#">Delete</a>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
<!-- Create Shipment Modal -->
<div id="createModal" style="display:none;" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      CREATE SHIPMENT
    </div>
    <div class="modal-body">
      <div class="modal-column">
        <label>Importer</label>
        <input type="text" id="importerInput">

        <label>No. of Containers</label>
        <input type="number" id="numContainers">

        <label>Container Size</label>
        <input type="text" id="containerSize">

        <label>Invoice Number</label>
        <input type="text" id="invoiceNumber">

        <label>B/L</label>
        <input type="text" id="blNumber">
      </div>
      <div class="modal-column">
        <label>Commodity</label>
       <input type="text" id="commodityInput">

        <label>Shipping Line</label>
        <input type="text" id="shippingLineInput">

        <label>ETA</label>
        <input type="date" id="etaDate">

        <label>Container Number/s</label>
        <div id="containerNumbersGroup">
          <div class="containerNumberRow">
            <input type="text" class="containerNumberInput">
            <button class="containerActionBtn" type="button" onclick="deleteContainerNumber(this)">−</button>
          </div>
          <button class="containerActionBtn" type="button" onclick="addContainerNumberField()">+</button>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button onclick="showCancellationModal()">Cancel</button>
      <button onclick="submitShipment()">Create</button>
    </div>
  </div>
</div>


  <!-- Edit Shipment Modal -->
  <div id="editModal" style="display: none;" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">EDIT SHIPMENT</div>
      <div class="modal-body">
        
        <!-- First Horizontal Row -->
        <div class="modal-row horizontal-row">
          <div class="modal-item">
            <label>Importer</label>
            <input type="text" id="importerInput">
          </div>

          <div class="modal-item">
            <label>Commodity</label>
            <input type="text" id="commodityInput">
          </div>

          <div class="modal-item">
            <label>No. of Containers</label>
            <input type="number" id="editNumContainers">
          </div>

          <div class="modal-item">
            <label>Shipping Line</label>
            <input type="text" id="shippingLineInput">
          </div>

          <div class="modal-item">
            <label>ETA</label>
            <input type="date" id="editEtaDate">
          </div>
        </div>

  <!-- Second Horizontal Row -->
  <div class="modal-row horizontal-row">
    <div class="modal-item">
      <label>B/L</label>
      <input type="text" id="editBlNumber">
    </div>

    <div class="modal-item">
      <label>Invoice Number</label>
      <input type="text" id="editInvoiceNumber">
    </div>

    <div class="modal-item">
      <label>Container Number/s</label>
      <div id="editContainerNumbersGroup" class="container-number-group">
        <!-- JS inserts container number inputs here -->
      </div>
    </div>
    
       

    <div class="modal-item">
      <label>Container Size</label>
      <input type="text" id="editContainerSize">
    </div>
  </div>

</div>

    <div class="modal-footer">
      <button onclick="showCancelEditConfirm()">Cancel Edit</button>
      <button onclick="saveEditShipment()">Save Edit</button>
    </div>
  </div>
</div>


<!-- Shipment Details Modal -->
<div id="detailsModal" style="display:none;" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">SHIPMENT DETAILS</div>
    <div class="modal-body">
      <div class="modal-column">
        <label>Importer</label>
        <input type="text" id="importerInput" readonly>

        <label>No. of Containers</label>
        <input type="number" id="detailsNumContainers" readonly>

        <label>Container Size</label>
        <input type="text" id="detailsContainerSize" readonly>

        <label>Invoice Number</label>
        <input type="text" id="detailsInvoiceNumber" readonly>

        <label>B/L</label>
        <input type="text" id="detailsBlNumber" readonly>
      </div>
      <div class="modal-column">
        <label>Commodity</label>
        <input type="text" id="commodityInput" readonly>

        <label>Shipping Line</label>
        <input type="text" id="shippingLineInput" readonly>

        <label>ETA</label>
        <input type="date" id="detailsEtaDate" readonly>

        <label>Container Number/s</label>
        <div id="detailsContainerNumbersGroup">
          <!-- Container numbers will be inserted here -->
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button onclick="closeDetailsModal()">Close</button>
    </div>
  </div>
</div>





  <!-- Confirmation Modal -->
  <div id="confirmationModal" class="confirmation-modal">
    <div class="confirmation-modal-header">CONFIRMATION</div>
    <div class="confirmation-modal-body">
      Your shipment has been successfully created.
    </div>
    <div class="confirmation-modal-footer">
      <button onclick="closeConfirmationModal()">Close</button>
    </div>
  </div>

  <div id="cancellationModal" class="cancellation-modal">
    <div class="cancellation-modal-header">CONFIRM CANCELLATION</div>
    <div class="cancellation-modal-body">
      Are you sure you want to cancel creating this shipment?<br>
      All entered information will be lost.
    </div>
    <div class="cancellation-modal-footer">
      <button id="cancelNoBtn" onclick="goBackToCreateModal()">No, Go Back</button>
      <button id="cancelYesBtn" onclick="confirmCancel()">Yes, Cancel</button>
    </div>
  </div>

  <!-- Confirmation Modal (Delete) -->
  <div class="confirmation-modal" id="confirmationDeleteModal">
    <div class="confirmation-modal-header">CONFIRM DELETION</div>
    <div class="confirmation-modal-body">
      Are you sure you want to delete this shipment record? <br>
      This action cannot be undone.
    </div>
    <div class="confirmation-modal-footer">
      <button id="cancelDeleteBtn">Cancel</button>
      <button id="confirmDeleteBtn">Yes, Delete</button>
    </div>
  </div>

<div id="cancelEditConfirmModal" class="cancel-confirm-overlay" style="display: none;">
  <div class="cancel-confirm-content">
    <div class="cancel-confirm-header">CONFIRMATION</div>
    <div class="cancel-confirm-body">
      Are you sure you want to cancel? All unsaved changes will be lost.
    </div>
    <div class="cancel-confirm-footer">
      <button onclick="confirmCancelEdit()">Yes, Cancel</button>
      <button onclick="closeCancelEditConfirm()">No, Go Back</button>
    </div>
  </div>
</div>

<div class="confirmation-modal" id="confirmationAfterDeleteModal" style="display: none;">
  <div class="confirmation-modal-header">CONFIRMATION</div>
  <div class="confirmation-modal-body">
    Your shipment has been successfully deleted.
  </div>
  <div class="confirmation-modal-footer" style="text-align: right;">
    <button onclick="closeAfterDeleteConfirmation()">Close</button>
  </div>
</div>


<script>

    const sidebar = document.getElementById("mySidebar");
    const topbar = document.getElementById("topbar");
    const mainContent = document.getElementById("mainContent");
    const toggleBtn = document.getElementById("toggleSidebar");

    document.addEventListener('DOMContentLoaded', () => {
      const savedState = localStorage.getItem('sidebarState');
      const isCollapsed = savedState === 'collapsed';

      if (isCollapsed) {
        sidebar.classList.add("collapsed");
        topbar.classList.remove("shifted");
        mainContent.classList.remove("shifted");
      } else {
        sidebar.classList.remove("collapsed");
        topbar.classList.add("shifted");
        mainContent.classList.add("shifted");
      }
    });
       
    toggleBtn.addEventListener("click", () => {
  sidebar.classList.toggle("collapsed");
  const isCollapsed = sidebar.classList.contains("collapsed");

  // Save the state
  localStorage.setItem('sidebarState', isCollapsed ? 'collapsed' : 'expanded');

  // Toggle layout shift class
  topbar.classList.toggle("shifted", !isCollapsed);
  mainContent.classList.toggle("shifted", !isCollapsed);
}); 

  // Show confirmation modal for delete action
  function showDeleteConfirmation(event) {
    document.getElementById('confirmationDeleteModal').style.display = 'block';
    // Pass the target row to delete
    const rowToDelete = event.target.closest('tr');
    document.getElementById('confirmDeleteBtn').onclick = function () {
      rowToDelete.remove(); // Remove the row
      hideDeleteConfirmation(); // Close the modal
    };
  }

  // Hide the confirmation modal
  function hideDeleteConfirmation() {
    document.getElementById('confirmationDeleteModal').style.display = 'none';
  }

  // Attach delete confirmation modal to delete action
  document.querySelectorAll('.popup-menu a').forEach(item => {
    item.addEventListener('click', function(event) {
      if (event.target.textContent === 'Delete') {
        showDeleteConfirmation(event);
      }
    });
  });

  // Close the delete confirmation modal on cancel
  document.getElementById('cancelDeleteBtn').addEventListener('click', hideDeleteConfirmation);

    const encodingOptions = ["FOR PRESAD", "UPLOADED", "FOR UPLOADING", "FAN PAID", "FOR DT/PC", "FOR CHECKING"];
    const shippingLineOptions = ["FOR DELIVERY", "DELIVERED/FOR BILLING", "CONTAINER DEPOSIT", "SL/ADR/CD/WH", "BILLED", "NEW SHIPMENT"];
    const cdOptions = ["NO CD", "CD", "CD COLLECTED"];

document.getElementById('updateBtn').addEventListener('click', function() {
    const rows = document.querySelectorAll('#shipmentTable tbody tr');
    rows.forEach(row => {
        const currentEncoding = row.cells[1].getAttribute('data-value');
        const currentShipping = row.cells[2].getAttribute('data-value');
        const currentCD = row.cells[6].getAttribute('data-value');

        if (!row.cells[1].querySelector('select')) {
            row.cells[1].innerHTML = createDropdown(encodingOptions, currentEncoding);
        }
        if (!row.cells[2].querySelector('select')) {
            row.cells[2].innerHTML = createDropdown(shippingLineOptions, currentShipping);
        }
        if (!row.cells[6].querySelector('select')) {
            row.cells[6].innerHTML = createDropdown(cdOptions, currentCD);
        }
    });

    document.getElementById('updateBtn').style.display = 'none';
    document.getElementById('saveBtn').style.display = 'inline-block';
});

document.getElementById('saveBtn').addEventListener('click', function() {
    const rows = document.querySelectorAll('#shipmentTable tbody tr');
    const updates = [];

    rows.forEach(row => {
        const id = row.getAttribute('data-id');

        const encoding_status = row.cells[1].querySelector('select').value;
        const shipping_status = row.cells[2].querySelector('select').value;
        const cd_status = row.cells[6].querySelector('select').value;

        updates.push({ id, encoding_status, shipping_status, cd_status });

        row.cells[1].innerHTML = encoding_status;
        row.cells[1].setAttribute('data-value', encoding_status);

        row.cells[2].innerHTML = shipping_status;
        row.cells[2].setAttribute('data-value', shipping_status);

        row.cells[6].innerHTML = cd_status;
        row.cells[6].setAttribute('data-value', cd_status);
    });

    fetch('shipment_api.php?action=bulk_update', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updates)
    })
    .then(res => res.json())
    .then(response => {
        if (response.success) {
            alert('Updates saved!');
            fetchShipments();
        } else {
            alert('Error saving updates: ' + response.error);
        }
    })
    .catch(err => alert('Fetch error: ' + err));

    document.getElementById('updateBtn').style.display = 'inline-block';
    document.getElementById('saveBtn').style.display = 'none';
});

function createDropdown(options, selectedValue) {
    selectedValue = selectedValue?.trim(); // Ensure no whitespace issues
    let dropdown = '<select>';
    options.forEach(option => {
        const isSelected = option === selectedValue ? 'selected' : '';
        dropdown += `<option value="${option}" ${isSelected}>${option}</option>`;
    });
    dropdown += '</select>';
    return dropdown;
}

    function togglePopup(event) {
      const popup = event.target.nextElementSibling;
      document.querySelectorAll('.popup-menu').forEach(p => {
        if (p !== popup) p.style.display = 'none';
      });
      popup.style.display = (popup.style.display === 'block') ? 'none' : 'block';
    }

    window.addEventListener('click', function(e) {
      if (!e.target.closest('.dot-icon')) {
        document.querySelectorAll('.popup-menu').forEach(function(menu) {
          menu.style.display = 'none';
        });
      }
    });

    function openCreateModal() {
      document.getElementById('createModal').style.display = 'flex';
    }

    function closeCreateModal() {
      document.getElementById('createModal').style.display = 'none';
    }

    // Function to add a new container number input field
function addContainerNumberField() {
  const containerNumbersGroup = document.getElementById('containerNumbersGroup');
  
  // Create a new container row with input and delete button
  const newContainerRow = document.createElement('div');
  newContainerRow.classList.add('containerNumberRow');
  
  const newInput = document.createElement('input');
  newInput.type = 'text';
  newInput.classList.add('containerNumberInput');
  
  const deleteButton = document.createElement('button');
  deleteButton.type = 'button';
  deleteButton.classList.add('deleteContainerBtn');
  deleteButton.textContent = '-'; // Simple dash (hyphen-minus)
  deleteButton.onclick = function() { deleteContainerNumber(deleteButton); };
  
  newContainerRow.appendChild(newInput);
  newContainerRow.appendChild(deleteButton);
  
  containerNumbersGroup.insertBefore(newContainerRow, containerNumbersGroup.lastElementChild);
}

  // Function to delete a container number input field
  function deleteContainerNumber(button) {
    const containerRow = button.parentElement;
    containerRow.remove(); // Removes the entire container row (input + delete button)
  }

   function submitShipment() {
    const formData = new FormData();
    formData.append('importer', document.getElementById('importerInput').value);
    formData.append('commodity', document.getElementById('commodityInput').value);
    formData.append('num_containers', document.getElementById('numContainers').value);
    formData.append('cd_status', 'NO CD'); // Default value for now
    formData.append('shipping_line', document.getElementById('shippingLineInput').value);
    formData.append('eta', document.getElementById('etaDate').value);
    formData.append('bl_number', document.getElementById('blNumber').value);
    formData.append('invoice_number', document.getElementById('invoiceNumber').value);
    formData.append('container_size', document.getElementById('containerSize').value);

    // Gather container numbers as comma-separated
    const containerInputs = document.querySelectorAll('#containerNumbersGroup .containerNumberInput');
    const containerNumbers = Array.from(containerInputs).map(input => input.value).join(',');
    formData.append('container_numbers', containerNumbers);

    // Set default status + days_remaining
    formData.append('encoding_status', 'FOR PRESAD');
    formData.append('shipping_status', 'NEW SHIPMENT');
    formData.append('days_remaining', '15');

    fetch('shipment_api.php?action=create', { method: 'POST', body: formData })
        .then(res => res.json())
        .then(response => {
            if (response.success) {
                closeCreateModal();
                showConfirmationModal();
                fetchShipments(); // Refresh table
            } else {
                alert('Error: ' + response.error);
            }
        })
        .catch(error => alert('Fetch error: ' + error));
}


    function showConfirmationModal() {
      document.getElementById('confirmationModal').style.display = 'block';
    }

    function closeConfirmationModal() {
      document.getElementById('confirmationModal').style.display = 'none';
    }

    document.getElementById('createBtn').addEventListener('click', openCreateModal);

  // Show the cancellation confirmation modal
  function showCancellationModal() {
    document.getElementById('cancellationModal').style.display = 'block';
  }

  // Hide the cancellation modal and return to create modal
  function goBackToCreateModal() {
    document.getElementById('cancellationModal').style.display = 'none';
    document.getElementById('createModal').style.display = 'flex';
  }

  function goBackToCreateModal() {
    document.getElementById('cancellationModal').style.display = 'none';
    document.getElementById('createModal').style.display = 'flex';
  }

  function confirmCancel() {
    document.getElementById('cancellationModal').style.display = 'none';
    document.getElementById('createModal').style.display = 'none';
  }

  function openEditModal() {
    document.getElementById('editModal').style.display = 'flex';
    // Populate dropdowns with values from database if needed
    populateDropdown('editImporterSelect', ['Importer A', 'Importer B']); // Replace with DB call
    populateDropdown('editCommoditySelect', ['Electronics', 'Textiles']); // Replace with DB call
    populateDropdown('editShippingLineSelect', ['Shipping Line A', 'Shipping Line B']); // Replace with DB call
  }

  function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
  }

  function saveEditShipment() {
    // Save logic here
    closeEditModal();
    showConfirmationModal(); // Or another modal if you prefer a different one
  }

  function addEditContainerNumberField() {
  const containerGroup = document.getElementById('editContainerNumbersGroup');

  // Create a new input field
  const newWrapper = document.createElement('div');
  newWrapper.className = 'containerNumberWrapper';

  const input = document.createElement('input');
  input.type = 'text';
  input.className = 'editContainerNumberInput';

  // Create the remove button (−)
  const removeBtn = document.createElement('button');
  removeBtn.type = 'button';
  removeBtn.textContent = '−';
  removeBtn.onclick = function () {
    removeContainerNumberField(removeBtn);
  };

  newWrapper.appendChild(input);
  newWrapper.appendChild(removeBtn);
  containerGroup.appendChild(newWrapper);

 // Add + button to add more container numbers (only if not already there)
if (!document.getElementById('editAddContainerBtn')) {
  const addBtn = document.createElement('button');
  addBtn.id = 'editAddContainerBtn';
  addBtn.type = 'button';
  addBtn.textContent = '+';
  addBtn.onclick = addEditContainerNumberField;
  containerGroup.appendChild(addBtn);
}
}


  function removeContainerNumberField(button) {
    const wrapper = button.parentElement;
    wrapper.remove();
  }

  function populateDropdown(selectId, items) {
    const select = document.getElementById(selectId);
    select.innerHTML = ''; // Clear previous options
    items.forEach(item => {
      const option = document.createElement('option');
      option.value = item;
      option.textContent = item;
      select.appendChild(option);
    });
  }

function openEditFromRow(event) {
  event.preventDefault();
  const row = event.target.closest('tr');

  // Get values from row
  const importer = row.cells[3].textContent;
  const commodity = row.cells[4].textContent;
  const numContainers = row.cells[5].textContent;
  const cd = row.cells[6].textContent;
  const shippingLine = row.cells[7].textContent;
  const eta = row.cells[8].textContent;
  const containerNumbers = row.cells[9].textContent.split(','); // Assuming comma-separated

  // Simulated data fetch (replace with DB data if available)
  populateDropdown('editImporterSelect', ['Importer A', 'Importer B']);
  populateDropdown('editCommoditySelect', ['Electronics', 'Textiles']);
  populateDropdown('editShippingLineSelect', ['Shipping Line A', 'Shipping Line B']);

  // Set values in the modal
  document.getElementById('editImporterSelect').value = importer;
  document.getElementById('editCommoditySelect').value = commodity;
  document.getElementById('editNumContainers').value = numContainers;
  document.getElementById('editShippingLineSelect').value = shippingLine;
  document.getElementById('editEtaDate').value = eta;

  // Placeholder values for now
  document.getElementById('editBlNumber').value = 'BL123456';
  document.getElementById('editInvoiceNumber').value = 'INV7890';
  document.getElementById('editContainerSize').value = '20FT';

  // Reset container numbers and remove any existing "+" button
  const containerGroup = document.getElementById('editContainerNumbersGroup');
  containerGroup.innerHTML = ''; // ✅ Clear all children (inputs and + button)

  // Create input fields for each container number
  containerNumbers.forEach(containerNumber => {
    const wrapper = document.createElement('div');
    wrapper.className = 'containerNumberWrapper';

    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'editContainerNumberInput';
    input.value = containerNumber.trim();

    const removeBtn = document.createElement('button');
    removeBtn.type = 'button';
    removeBtn.textContent = '−';
    removeBtn.onclick = function () {
      removeContainerNumberField(removeBtn);
    };

    wrapper.appendChild(input);
    wrapper.appendChild(removeBtn);
    containerGroup.appendChild(wrapper);
  });

  // ✅ Add "+" button only if not already added
  if (!document.getElementById('editAddContainerBtn')) {
    const addBtn = document.createElement('button');
    addBtn.id = 'editAddContainerBtn';
    addBtn.type = 'button';
    addBtn.textContent = '+';
    addBtn.onclick = addEditContainerNumberField;
    containerGroup.appendChild(addBtn);
  }

  // Show the modal
  openEditModal();
}

  function showCancelEditConfirm() {
    document.getElementById('cancelEditConfirmModal').style.display = 'flex';
  }

  function closeCancelEditConfirm() {
    document.getElementById('cancelEditConfirmModal').style.display = 'none';
  }

  function confirmCancelEdit() {
    closeCancelEditConfirm();
    closeEditModal();
  }

  function openDetailsFromRow(event) {
    event.preventDefault();
    const row = event.target.closest('tr');

  // Sample data fetch (replace with actual DB values as needed)
  const importer = row.cells[3].textContent;
  const commodity = row.cells[4].textContent;
  const numContainers = row.cells[5].textContent;
  const cd = row.cells[6].textContent;
  const shippingLine = row.cells[7].textContent;
  const eta = row.cells[8].textContent;
  const containerNumbers = row.cells[9].textContent.split(',');

  populateDropdown('detailsImporterSelect', ['Importer A', 'Importer B']);
  populateDropdown('detailsCommoditySelect', ['Electronics', 'Textiles']);
  populateDropdown('detailsShippingLineSelect', ['Shipping Line A', 'Shipping Line B']);

  document.getElementById('detailsImporterSelect').value = importer;
  document.getElementById('detailsCommoditySelect').value = commodity;
  document.getElementById('detailsNumContainers').value = numContainers;
  document.getElementById('detailsShippingLineSelect').value = shippingLine;
  document.getElementById('detailsEtaDate').value = eta;

  // Placeholder data
  document.getElementById('detailsBlNumber').value = 'BL123456';
  document.getElementById('detailsInvoiceNumber').value = 'INV7890';
  document.getElementById('detailsContainerSize').value = '20FT';

  const containerGroup = document.getElementById('detailsContainerNumbersGroup');
  containerGroup.innerHTML = '';
  containerNumbers.forEach(number => {
    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'containerNumberInput';
    input.value = number.trim();
    input.readOnly = true;
    containerGroup.appendChild(input);
  });

  document.getElementById('detailsModal').style.display = 'flex';
  }

  function closeDetailsModal() {
    document.getElementById('detailsModal').style.display = 'none';
  }

  // Function to open the success confirmation modal
  function openConfirmationSuccessModal() {
    document.getElementById('confirmationSuccessModal').style.display = 'flex';
  }

  // Function to close the success confirmation modal
  function closeConfirmationSuccessModal() {
    document.getElementById('confirmationSuccessModal').style.display = 'none';
  }

  document.getElementById('confirmDeleteBtn').onclick = function () {
    const rowToDelete = document.querySelector('.pending-delete-row');
    if (rowToDelete) rowToDelete.remove(); // Remove the row
    hideDeleteConfirmation(); // Hide the confirmation dialog
    showAfterDeleteConfirmation(); // Show success message
  };

  function showDeleteConfirmation(event) {
    const rowToDelete = event.target.closest('tr');
    rowToDelete.classList.add('pending-delete-row'); // Mark it for deletion
    document.getElementById('confirmationDeleteModal').style.display = 'block';
  }

  function showAfterDeleteConfirmation() {
    document.getElementById('confirmationAfterDeleteModal').style.display = 'block';
    document.querySelectorAll('.pending-delete-row').forEach(row => {
      row.classList.remove('pending-delete-row');
    });
  }

  function closeAfterDeleteConfirmation() {
    document.getElementById('confirmationAfterDeleteModal').style.display = 'none';
  }

// Fetch and display shipments
function fetchShipments() {
    fetch('shipment_api.php?action=fetch')
        .then(res => res.json())
        .then(data => {
            const tbody = document.querySelector('#shipmentTable tbody');
            tbody.innerHTML = '';
            data.forEach((row, idx) => {
                const tr = document.createElement('tr');
                tr.setAttribute('data-id', row.id);

                tr.innerHTML = `
                    <td>${idx + 1}</td>
                    <td data-value="${row.encoding_status}">${row.encoding_status}</td>
                    <td data-value="${row.shipping_status}">${row.shipping_status}</td>
                    <td>${row.importer}</td>
                    <td>${row.commodity}</td>
                    <td>${row.num_containers}</td>
                    <td data-value="${row.cd_status}">${row.cd_status}</td>
                    <td>${row.shipping_line}</td>
                    <td>${row.eta}</td>
                    <td>${row.days_remaining}</td>
                    <td class="actions">
                        <span class="dot-icon" onclick="togglePopup(event)">...</span>
                        <div class="popup-menu">
                            <a href="#" onclick="openDetailsFromRow(event, ${row.id})">Details</a>
                            <a href="#" onclick="openEditFromRow(event, ${row.id})">Edit</a>
                            <a href="#" onclick="deleteShipment(${row.id})">Delete</a>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        });
}

document.addEventListener('DOMContentLoaded', fetchShipments);

function deleteShipment(id) {
    if (confirm("Are you sure you want to delete this shipment?")) {
        fetch(`shipment_api.php?action=delete&id=${id}`, {
            method: 'GET', // or POST depending on how you handle it
        })
        .then(res => res.json())
        .then(response => {
            if (response.success) {
                alert('Shipment deleted successfully!');
                fetchShipments(); // Refresh the table
            } else {
                alert('Error deleting shipment');
            }
        })
        .catch(err => alert('Error: ' + err));
    }
}

document.getElementById('logoutBtn').addEventListener('click', function (e) {
  e.preventDefault();
  
  // Clear any stored auth data (example: localStorage, sessionStorage, cookies)
  localStorage.clear();
  sessionStorage.clear();
  // If you use cookies for auth (optional — depends on your backend)
  document.cookie = 'session=; Max-Age=0; path=/;';

  // Redirect to login page
  window.location.href = 'LoginPage.html';
});

function bindPopupActions(row) {
  const detailsBtn = row.querySelector('.details-btn');
  const editBtn = row.querySelector('.edit-btn');
if (detailsBtn) {
    detailsBtn.addEventListener('click', openDetailsFromRow);
  }
  if (editBtn) {
    editBtn.addEventListener('click', openEditFromRow);
  }
}
function openDetailsFromRow(event) {
  event.preventDefault();
  event.stopPropagation();

  const row = event.target.closest('tr');
  if (!row) return;

  document.getElementById('detailsImporter').value = row.cells[3].textContent;
  document.getElementById('detailsCommodity').value = row.cells[4].textContent;
  document.getElementById('detailsNumContainers').value = row.cells[5].textContent;
  document.getElementById('detailsContainerSize').value = '20FT';
  document.getElementById('detailsInvoiceNumber').value = 'INV123';
  document.getElementById('detailsBlNumber').value = 'BL456';
  document.getElementById('detailsShippingLine').value = row.cells[7].textContent;
  document.getElementById('detailsEtaDate').value = row.cells[8].textContent;

  const containerGroup = document.getElementById('detailsContainerNumbersGroup');
  containerGroup.innerHTML = '';
  row.cells[9].textContent.split(',').forEach(number => {
    const input = document.createElement('input');
    input.type = 'text';
    input.value = number.trim();
    input.readOnly = true;
    containerGroup.appendChild(input);
  });

  document.getElementById('detailsModal').style.display = 'flex';
}

function openEditFromRow(event) {
  event.preventDefault();
  event.stopPropagation();

  const row = event.target.closest('tr');
  if (!row) return;

  document.getElementById('editImporter').value = row.cells[3].textContent;
  document.getElementById('editCommodity').value = row.cells[4].textContent;
  document.getElementById('editContainers').value = row.cells[5].textContent;
  document.getElementById('editShippingLine').value = row.cells[7].textContent;
  document.getElementById('editEtaDate').value = row.cells[8].textContent;
  document.getElementById('editBlNumber').value = 'BL456';
  document.getElementById('editInvoiceNumber').value = 'INV123';
  document.getElementById('editContainerSize').value = '20FT';

  const containerGroup = document.getElementById('editContainerNumbersGroup');
  containerGroup.innerHTML = '';
  row.cells[9].textContent.split(',').forEach(number => {
    const wrapper = document.createElement('div');
    wrapper.className = 'containerNumberWrapper';
    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'editContainerNumberInput';
    input.value = number.trim();
    const removeBtn = document.createElement('button');
    removeBtn.textContent = '−';
    removeBtn.type = 'button';
    removeBtn.onclick = () => wrapper.remove();
    wrapper.appendChild(input);
    wrapper.appendChild(removeBtn);
    containerGroup.appendChild(wrapper);
  });

  if (!document.getElementById('editAddContainerBtn')) {
    const addBtn = document.createElement('button');
    addBtn.id = 'editAddContainerBtn';
    addBtn.textContent = '+';
    addBtn.type = 'button';
    addBtn.onclick = () => {
      const wrapper = document.createElement('div');
      wrapper.className = 'containerNumberWrapper';
      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'editContainerNumberInput';
      const removeBtn = document.createElement('button');
      removeBtn.textContent = '−';
      removeBtn.type = 'button';
      removeBtn.onclick = () => wrapper.remove();
      wrapper.appendChild(input);
      wrapper.appendChild(removeBtn);
      containerGroup.appendChild(wrapper);
    };
    containerGroup.appendChild(addBtn);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.popup-menu a').forEach(link => {
    if (link.textContent.includes('Details')) {
      link.addEventListener('click', openDetailsFromRow);
    } else if (link.textContent.includes('Edit')) {
      link.addEventListener('click', openEditFromRow);
    }
  });
});

function togglePopup(event) {
      const popup = event.target.nextElementSibling;
      document.querySelectorAll('.popup-menu').forEach(p => {
        if (p !== popup) p.style.display = 'none';
      });
      popup.style.display = (popup.style.display === 'block') ? 'none' : 'block';
    }

    window.addEventListener('click', function(e) {
      if (!e.target.closest('.dot-icon')) {
        document.querySelectorAll('.popup-menu').forEach(function(menu) {
          menu.style.display = 'none';
        });
      }
    });
// Function to open a modal and populate it with data
function openModal(modalId, data) {
    const modal = document.getElementById(modalId);
    if (modal) {
        // Populate modal fields with data
        for (const key in data) {
            const input = modal.querySelector(`[id="${key}"]`);
            if (input) {
                input.value = data[key];
            }
        }
        modal.style.display = 'flex'; // Show the modal
    }
}

// Function to close a modal
function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'none'; // Hide the modal
    }
}

// Function to handle opening the edit modal
function openEditFromRow(event, id) {
    event.preventDefault();
    const row = document.querySelector(`tr[data-id="${id}"]`);
    if (!row) return;

    const data = {
        id: id, // Pass the ID directly
        editImporter: row.cells[3].textContent,
        editCommodity: row.cells[4].textContent,
        editContainers: row.cells[5].textContent,
        editShippingLine: row.cells[7].textContent,
        editEtaDate: row.cells[8].textContent,
        editBlNumber: row.cells[6].textContent,
        editInvoiceNumber: row.cells[7].textContent,
        editContainerNumbers: row.cells[9].textContent.split(',').map(num => num.trim()).join(', ')
    };

    openModal('editModal', data);
}

// Function to handle opening the details modal
// Function to handle opening the details modal
// Function to handle opening the details modal
// Function to handle opening the details modal
function openDetailsFromRow(event, id) {
    event.preventDefault();

    // Fetch shipment details from the backend
    fetch(`shipment_api.php?action=fetchDetails&id=${id}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const detailsData = data.shipment; // Assuming the response contains a 'shipment' object
                const modal = document.getElementById('detailsModal');

                // Populate the fields in the modal
                document.getElementById('importerInput').value = detailsData.importer || '';
                document.getElementById('detailsNumContainers').value = detailsData.num_containers || '';
                document.getElementById('detailsContainerSize').value = detailsData.container_size || '';
                document.getElementById('detailsInvoiceNumber').value = detailsData.invoice_number || '';
                document.getElementById('detailsBlNumber').value = detailsData.bl_number || '';
                document.getElementById('commodityInput').value = detailsData.commodity || '';
                document.getElementById('shippingLineInput').value = detailsData.shipping_line || '';
                document.getElementById('detailsEtaDate').value = detailsData.eta || '';

                // Populate container numbers
                const containerNumbersGroup = document.getElementById('detailsContainerNumbersGroup');
                containerNumbersGroup.innerHTML = ''; // Clear previous entries
                detailsData.container_numbers.split(',').forEach(number => {
                    const containerInput = document.createElement('input');
                    containerInput.type = 'text';
                    containerInput.value = number.trim();
                    containerInput.readOnly = true; // Make it read-only
                    containerNumbersGroup.appendChild(containerInput);
                });

                // Show the modal
                modal.style.display = 'flex'; // Ensure the modal is displayed correctly
            } else {
                alert('Error fetching shipment details: ' + data.error);
            }
        })
        .catch(error => console.error('Error:', error));
}

document.querySelectorAll('.popup-menu a').forEach(link => {
    if (link.textContent.includes('Details')) {
        link.addEventListener('click', openDetailsFromRow);
    }
});

</script>
</body>
</html>